<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de M√≠dias</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-logo">üé¨ Sistema de M√≠dias</h1>
            <div class="nav-links">
                <a href="/dashboard" class="active">Dashboard</a>
                <a href="/medias">M√≠dias</a>
                <a href="/medias/new">Nova M√≠dia</a>
                <button id="logout-btn" class="btn-logout">Sair</button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="dashboard">
            <div class="dashboard-header">
                <h1>üìä Dashboard</h1>
                <p>Vis√£o geral da sua cole√ß√£o de m√≠dias</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üìÄ</div>
                    <div class="stat-info">
                        <h3>Total de M√≠dias</h3>
                        <p id="total-medias" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-info">
                        <h3>Livros</h3>
                        <p id="livros-count" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üé•</div>
                    <div class="stat-info">
                        <h3>DVDs</h3>
                        <p id="dvds-count" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üíø</div>
                    <div class="stat-info">
                        <h3>CD</h3>
                        <p id="cd4-count" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">üßç</div>
                    <div class="stat-info">
                        <h3>Autores</h3>
                        <p id="autores-count" class="stat-number">0</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-actions">
                <h2>A√ß√µes R√°pidas</h2>
                <div class="action-buttons">
                    <a href="/medias/new" class="btn btn-primary">
                        ‚ûï Adicionar Nova M√≠dia
                    </a>
                    <a href="/medias" class="btn btn-secondary">
                        üìã Ver Todas as M√≠dias
                    </a>
                </div>
            </div>

            <div class="recent-medias">
                <h2>√öltimas M√≠dias Adicionadas</h2>
                <div id="recent-medias-list" class="medias-list">
                    <div class="loading">Carregando m√≠dias...</div>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/api.js"></script>
    <script>
        class Dashboard {
            constructor() {
                this.checkAuth();
                this.loadStats();
                this.loadRecentMedias();
                this.setupEventListeners();
            }

            checkAuth() {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = '/login';
                    return;
                }
            }

            async loadStats() {
                try {
                    const medias = await MediaAPI.getMedias();
                    
                    // Atualizar contadores
                    document.getElementById('total-medias').textContent = medias.length;
                    document.getElementById('livros-count').textContent = medias.filter(m => m.tipo === 'Livros').length;
                    document.getElementById('dvds-count').textContent = medias.filter(m => m.tipo === 'DVD').length;
                    document.getElementById('cd4-count').textContent = medias.filter(m => m.tipo === 'CD4').length;
                    document.getElementById('autores-count').textContent = medias.filter(m => m.tipo === 'Autores').length;
                    
                } catch (error) {
                    console.error('Erro ao carregar estat√≠sticas:', error);
                }
            }

            async loadRecentMedias() {
                try {
                    const medias = await MediaAPI.getMedias();
                    const recentMedias = medias.slice(-5).reverse(); // √öltimas 5
                    
                    const container = document.getElementById('recent-medias-list');
                    
                    if (recentMedias.length === 0) {
                        container.innerHTML = '<div class="empty-state">Nenhuma m√≠dia encontrada</div>';
                        return;
                    }
                    
                    container.innerHTML = recentMedias.map(media => `
                        <div class="media-item">
                            <div class="media-type">${this.getTypeIcon(media.tipo)}</div>
                            <div class="media-info">
                                <h4>${media.titulo}</h4>
                                <p>${new Date(media.data).toLocaleDateString('pt-BR')}</p>
                            </div>
                            <div class="media-adobe">
                                ${media.adobe ? `Adobe: ${media.adobe}` : ''}
                            </div>
                        </div>
                    `).join('');
                    
                } catch (error) {
                    console.error('Erro ao carregar m√≠dias recentes:', error);
                }
            }

            getTypeIcon(tipo) {
                const icons = {
                    'Livros': 'üìö',
                    'DVD': 'üé•',
                    'CD': 'üíø',
                    'Autor': 'üßç'
                };
                return icons[tipo] || 'üìÄ';
            }

            setupEventListeners() {
                // Bot√£o de logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    localStorage.removeItem('token');
                    window.location.href = '/';
                });

                // Bot√£o de atualizar
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    this.loadStats();
                    this.loadRecentMedias();
                });
            }
        }

        // Inicializar dashboard quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            new Dashboard();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de MÃ­dias</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-logo">ðŸŽ¬ Sistema de MÃ­dias</h1>
            <div class="nav-links">
                <span id="user-greeting">Carregando...</span>
                <a href="/dashboard" class="active">Dashboard</a>
                <a href="/medias">MÃ­dias</a>
                <a href="/medias/new">Nova MÃ­dia</a>
                <button id="logout-btn" class="btn-logout">Sair</button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="dashboard">
            <div class="dashboard-header">
                <h1>ðŸ“Š Dashboard</h1>
                <p>VisÃ£o geral da sua coleÃ§Ã£o de mÃ­dias</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ðŸ“€</div>
                    <div class="stat-info">
                        <h3>Total de MÃ­dias</h3>
                        <p id="total-medias" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">ðŸŽ¬</div>
                    <div class="stat-info">
                        <h3>Lucas</h3>
                        <p id="lucas-count" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">ðŸŽ¥</div>
                    <div class="stat-info">
                        <h3>DVDs</h3>
                        <p id="dvds-count" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">ðŸ’¿</div>
                    <div class="stat-info">
                        <h3>CD4</h3>
                        <p id="cd4-count" class="stat-number">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">ðŸŽµ</div>
                    <div class="stat-info">
                        <h3>Audio</h3>
                        <p id="audio-count" class="stat-number">0</p>
                    </div>
                </div>
            </div>

            <div class="dashboard-actions">
                <h2>AÃ§Ãµes RÃ¡pidas</h2>
                <div class="action-buttons">
                    <a href="/medias/new" class="btn btn-primary">
                        âž• Adicionar Nova MÃ­dia
                    </a>
                    <a href="/medias" class="btn btn-secondary">
                        ðŸ“‹ Ver Todas as MÃ­dias
                    </a>
                    <button id="refresh-btn" class="btn btn-outline">
                        ðŸ”„ Atualizar Dados
                    </button>
                </div>
            </div>

            <div class="recent-medias">
                <h2>Ãšltimas MÃ­dias Adicionadas</h2>
                <div id="recent-medias-list" class="medias-list">
                    <div class="loading">Carregando mÃ­dias...</div>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/api.js"></script>
    <script>
        class Dashboard {
            constructor() {
                this.checkAuth();
                this.loadStats();
                this.loadRecentMedias();
                this.setupEventListeners();
            }

            checkAuth() {
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = '/login';
                    return;
                }
            }

            async loadStats() {
                try {
                    const medias = await MediaAPI.getMedias();
                    
                    // Atualizar contadores
                    document.getElementById('total-medias').textContent = medias.length;
                    document.getElementById('lucas-count').textContent = medias.filter(m => m.tipo === 'Lucas').length;
                    document.getElementById('dvds-count').textContent = medias.filter(m => m.tipo === 'DVD').length;
                    document.getElementById('cd4-count').textContent = medias.filter(m => m.tipo === 'CD4').length;
                    document.getElementById('audio-count').textContent = medias.filter(m => m.tipo === 'Audio').length;
                    
                } catch (error) {
                    console.error('Erro ao carregar estatÃ­sticas:', error);
                }
            }

            async loadRecentMedias() {
                try {
                    const medias = await MediaAPI.getMedias();
                    const recentMedias = medias.slice(-5).reverse(); // Ãšltimas 5
                    
                    const container = document.getElementById('recent-medias-list');
                    
                    if (recentMedias.length === 0) {
                        container.innerHTML = '<div class="empty-state">Nenhuma mÃ­dia encontrada</div>';
                        return;
                    }
                    
                    container.innerHTML = recentMedias.map(media => `
                        <div class="media-item">
                            <div class="media-type">${this.getTypeIcon(media.tipo)}</div>
                            <div class="media-info">
                                <h4>${media.titulo}</h4>
                                <p>${new Date(media.data).toLocaleDateString('pt-BR')}</p>
                            </div>
                            <div class="media-adobe">
                                ${media.adobe ? `Adobe: ${media.adobe}` : ''}
                            </div>
                        </div>
                    `).join('');
                    
                } catch (error) {
                    console.error('Erro ao carregar mÃ­dias recentes:', error);
                }
            }

            getTypeIcon(tipo) {
                const icons = {
                    'Lucas': 'ðŸŽ¬',
                    'DVD': 'ðŸŽ¥',
                    'CD4': 'ðŸ’¿',
                    'Audio': 'ðŸŽµ'
                };
                return icons[tipo] || 'ðŸ“€';
            }

            setupEventListeners() {
                // BotÃ£o de logout
                document.getElementById('logout-btn').addEventListener('click', () => {
                    localStorage.removeItem('token');
                    window.location.href = '/';
                });

                // BotÃ£o de atualizar
                document.getElementById('refresh-btn').addEventListener('click', () => {
                    this.loadStats();
                    this.loadRecentMedias();
                });
            }
        }

        // Inicializar dashboard quando a pÃ¡gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            new Dashboard();
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de M√≠dias</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-logo">üé¨ Sistema de M√≠dias</h1>
            <div class="nav-links">
                <a href="/">Home</a>
                <a href="/login">Login</a>
            </div>
        </div>
    </nav>

        <div class="auth-container">
            <!-- FORMUL√ÅRIO DE LOGIN -->
            <div class="auth-card">
                <h2>üîê Login</h2>
                
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" required 
                            placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label for="login-password">Senha:</label>
                        <input type="password" id="login-password" required 
                            placeholder="Sua senha" minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        üöÄ Entrar
                    </button>
                </form>

                <div class="auth-divider">
                    <span>ou</span>
                </div>

                <!-- LOGIN MOCK (para desenvolvimento) -->
                <div class="demo-section">
                    <h4>Demo R√°pida</h4>
                    <button onclick="mockLogin('demo@exemplo.com', 'Usu√°rio Demo')" 
                            class="btn btn-outline" style="width: 100%; margin-bottom: 0.5rem;">
                        üë§ Entrar como Demo
                    </button>
                    <small style="color: #666;">Cria usu√°rio automaticamente</small>
                </div>
            </div>

            <!-- FORMUL√ÅRIO DE CADASTRO -->
            <div class="auth-card">
                <h2>üìù Cadastrar</h2>
                <p style="margin-bottom: 1.5rem; color: #666;">Crie sua conta</p>
                
                <form id="register-form" class="auth-form">
                    <div class="form-group">
                        <label for="register-name">Nome completo:</label>
                        <input type="text" id="register-name" required 
                            placeholder="Seu nome completo">
                    </div>
                    <div class="form-group">
                        <label for="register-email">Email:</label>
                        <input type="email" id="register-email" required 
                            placeholder="seu@email.com">
                    </div>
                    <div class="form-group">
                        <label for="register-password">Senha:</label>
                        <input type="password" id="register-password" required 
                            placeholder="M√≠nimo 6 caracteres" minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Confirmar senha:</label>
                        <input type="password" id="register-confirm-password" required 
                            placeholder="Digite a senha novamente">
                    </div>
                    <button type="submit" class="btn btn-success" style="width: 100%;">
                        ‚úÖ Criar Conta
                    </button>
                </form>
            </div>
        </div>

        <script>
            // LOGIN REAL
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                await authRequest('/api/auth/login', { email, password }, 'Login');
            });

            // CADASTRO REAL
            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                await authRequest('/api/auth/register', { 
                    name, email, password, confirmPassword 
                }, 'Cadastro');
            });

            // FUN√á√ÉO DE AUTENTICA√á√ÉO
            async function authRequest(url, data, action) {
                const submitBtn = event.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                
                submitBtn.textContent = '‚è≥ Processando...';
                submitBtn.disabled = true;
                
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        showSuccess(result.message);
                        
                        // Salvar token e dados
                        localStorage.setItem('token', result.token);
                        localStorage.setItem('user', JSON.stringify(result.user));
                        
                        // Redirecionar
                        setTimeout(() => {
                            window.location.href = '/dashboard';
                        }, 1000);
                        
                    } else {
                        showError(result.message);
                    }
                    
                } catch (error) {
                    console.error('Erro:', error);
                    showError('Erro de conex√£o com o servidor');
                } finally {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            }

            // LOGIN MOCK (para desenvolvimento)
            async function mockLogin(email = 'demo@exemplo.com', name = 'Usu√°rio Demo') {
                await authRequest('/api/auth/mock-login', { email, name }, 'Demo');
            }

            function showSuccess(message) {
                alert('‚úÖ ' + message);
            }

            function showError(message) {
                alert('‚ùå ' + message);
            }

            // Verificar se j√° est√° logado
            document.addEventListener('DOMContentLoaded', function() {
                const token = localStorage.getItem('token');
                if (token) {
                    window.location.href = '/dashboard';
                }
            });
        </script>
                
                </div>

                <div class="login-footer">
                    <p>N√£o tem conta? O login social criar√° automaticamente.</p>
                    <a href="/" class="btn-link">‚Üê Voltar para Home</a>
                </div>
            </div>
        </div>
    </main>

    <script>
           
        // Mostrar loading
        showLoading(`Entrando com ${provider}...`);

        try {
            const response = await fetch('/api/auth/mock-login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            const data = await response.json();

            if (data.success) {
                // Salvar token e dados do usu√°rio
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                
                showSuccess('Login realizado com sucesso!');
                
                // Redirecionar ap√≥s 1 segundo
                setTimeout(() => {
                    window.location.href = '/dashboard';
                }, 1000);
                
            } else {
                showError('Erro no login: ' + data.message);
            }

        } catch (error) {
            console.error('Erro:', error);
            showError('Erro de conex√£o com o servidor');
        } finally {
            hideLoading();
        }
    
    function showLoading(message) {
        // Criar overlay de loading
        const overlay = document.createElement('div');
        overlay.id = 'loading-overlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
        `;
        overlay.innerHTML = `
            <div style="text-align: center;">
                <div style="font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
                <div>${message}</div>
            </div>
        `;
        document.body.appendChild(overlay);
    }

    function hideLoading() {
        const overlay = document.getElementById('loading-overlay');
        if (overlay) {
            overlay.remove();
        }
    }

    function showSuccess(message) {
        alert('‚úÖ ' + message);
    }

    function showError(message) {
        alert('‚ùå ' + message);
    }
</script>

</body>
</html>